<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>é¦¬ä¾†è¥¿äºæ—…éŠè¡Œç¨‹</title>

  

  <style>
    body {
      background: #f6f5f3;
      font-family: sans-serif;
      display: flex;
      justify-content: center;
      padding: 20px;
    }
    .app {
      width: 380px;
      background: #fff;
      border-radius: 20px;
      padding: 20px;
    }
    .days {
      display: flex;
      overflow-x: auto;
      gap: 6px;
      margin-bottom: 12px;
    }
    .day-btn {
      padding: 6px 10px;
      border-radius: 12px;
      border: none;
      background: #eee;
      cursor: pointer;
    }
    .day-btn.active {
      background: #e5d5c3;
    }
    .tabs {
      display: flex;
      gap: 8px;
      margin: 10px 0;
    }
    .tab {
      flex: 1;
      padding: 8px;
      border-radius: 20px;
      border: none;
      background: #eee;
      cursor: pointer;
    }
    .tab.active {
      background: #e8dcca;
    }
    .card {
      background: #faf9f7;
      padding: 12px;
      border-radius: 12px;
      margin-bottom: 10px;
    }
    .add-btn {
      width: 100%;
      margin: 12px 0;
      padding: 10px;
      border-radius: 12px;
      border: none;
      background: #d9cbb6;
      cursor: pointer;
    }
  </style>
</head>

<body>
<div class="app">
  <div class="days" id="dayButtons"></div>
  <h1 id="dayTitle"></h1>

  <div class="tabs">
    <button class="tab active" data-category="spot">æ™¯é»</button>
    <button class="tab" data-category="food">ç¾é£Ÿ</button>
    <button class="tab" data-category="stay">ä½å®¿</button>
  </div>

  <div id="schedule"></div>
  <button class="add-btn" onclick="addPlace()">ï¼‹ æ–°å¢åœ°é»</button>

  <hr>

<h2>å¾…è¾¦äº‹é …</h2>
<ul id="todoList"></ul>
<button class="add-btn" onclick="addTodo()">ï¼‹ æ–°å¢å¾…è¾¦</button>

<h2>è¡Œææ¸…å–®</h2>
<ul id="luggageList"></ul>
<button class="add-btn" onclick="addLuggage()">ï¼‹ æ–°å¢è¡Œæ</button>

<h2>è³¼ç‰©æ¸…å–®</h2>
<ul id="shoppingList"></ul>
<button class="add-btn" onclick="addShopping()">ï¼‹ æ–°å¢è³¼ç‰©</button>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

 


// ===== Firebase åˆå§‹åŒ– =====
const firebaseConfig = {
  apiKey: "AIzaSyBOTh16RSCCca_FBUFiz0utDil-SlkZJKg",
  authDomain: "travel-plan-544b5.firebaseapp.com",
  projectId: "travel-plan-544b5",
  storageBucket: "travel-plan-544b5.firebasestorage.app",
  messagingSenderId: "794197854377",
  appId: "1:794197854377:web:5ac7eb18afb56618cf01b8",
  measurementId: "G-YQLWLZ66CS"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// ===== Day èˆ‡è³‡æ–™ =====
const days = [
  { date: "2/9", city: "å°ç£å‡ºç™¼" },
  { date: "2/10", city: "é¦¬å…­ç”²" },
  { date: "2/11", city: "æ³¢å¾·ç”³" },
  { date: "2/12", city: "æ³¢å¾·ç”³" },
  { date: "2/13", city: "å‰éš†å¡" },
  { date: "2/14", city: "å‰éš†å¡" },
  { date: "2/15", city: "æ¢³é‚¦" },
  { date: "2/16", city: "å›å°ç£" }
];
let currentDay = 0;
let currentCategory = "spot";

// æ¯ä¸€å¤©è³‡æ–™
const data = days.map(() => ({ spot: [], food: [], stay: [], todo: [] }));
const luggage = [];
const shopping = [];

// ===== Firebase Collections =====
const scheduleColl = collection(db, "schedule");
const todoColl = collection(db, "todo");
const luggageColl = collection(db, "luggage");
const shoppingColl = collection(db, "shopping");

// ===== å·¥å…·å‡½æ•¸ =====
function renderScheduleItems() {
  const container = document.getElementById("schedule");
  container.innerHTML = "";

  const items = data[currentDay][currentCategory];

  items.forEach((item, index) => {
    const div = document.createElement("div");
    div.className = "card";

    // åœ°é»æ–‡å­—
    const text = document.createElement("div");
    text.textContent = item.text;

    // æŸ¥çœ‹åœ°åœ–æŒ‰éˆ•
    const mapBtn = document.createElement("button");
    mapBtn.textContent = "ğŸ“ æŸ¥çœ‹åœ°åœ–";
    mapBtn.style.marginTop = "6px";
    mapBtn.onclick = () => {
      const url = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(item.text)}`;
      window.open(url, "_blank");
    };

    // åˆªé™¤æŒ‰éˆ•ï¼ˆä½ åŸæœ¬çš„ï¼‰
    const delBtn = document.createElement("button");
    delBtn.textContent = "X";
    delBtn.style.marginLeft = "10px";
    delBtn.onclick = async () => {
      items.splice(index, 1);
      div.remove();
      if (item.id) {
        await deleteDoc(doc(db, scheduleColl.path, item.id));
      }
    };

    div.appendChild(text);
    div.appendChild(mapBtn);
    div.appendChild(delBtn);
    container.appendChild(div);
  });
}


// ===== Day æŒ‰éˆ• =====
function renderDayButtons() {
  const container = document.getElementById("dayButtons");
  container.innerHTML = "";
  days.forEach((day, idx) => {
    const btn = document.createElement("button");
    btn.className = "day-btn";
    if (idx === currentDay) btn.classList.add("active");
    btn.textContent = `Day ${idx + 1}`;
    btn.onclick = () => {
      currentDay = idx;
      updateActiveDay();
      renderSchedule();
      renderScheduleItems();
      renderTodo();
      scrollActiveDayIntoView();
    };
    container.appendChild(btn);
  });
}

function updateActiveDay() {
  document.querySelectorAll(".day-btn").forEach((btn, idx) => {
    btn.classList.toggle("active", idx === currentDay);
  });
}

function scrollActiveDayIntoView() {
  const container = document.getElementById("dayButtons");
  const activeBtn = container.querySelector(".day-btn.active");
  if (activeBtn) activeBtn.scrollIntoView({ behavior: "smooth", inline: "center" });
}

// ===== Schedule & Tab =====
function renderSchedule() {
  document.getElementById("dayTitle").textContent = `${days[currentDay].date} ${days[currentDay].city}`;
}

function renderScheduleItems() {
  const container = document.getElementById("schedule");
  container.innerHTML = "";
  const items = data[currentDay][currentCategory];
  items.forEach((item, index) => {
    const div = document.createElement("div");
    div.className = "card";
    div.textContent = item.text;
    const delBtn = document.createElement("button");
    delBtn.textContent = "X";
    delBtn.style.marginLeft = "10px";
    delBtn.onclick = async () => {
      items.splice(index, 1);
      div.remove();
      if (item.id) await deleteDoc(doc(db, scheduleColl.path, item.id));
    };
    div.appendChild(delBtn);
    container.appendChild(div);
  });
}

// Tab åˆ‡æ›
document.querySelectorAll(".tab").forEach(tab => {
  tab.addEventListener("click", () => {
    document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
    tab.classList.add("active");
    currentCategory = tab.dataset.category;
    renderScheduleItems();
  });
});

// ===== æ–°å¢é …ç›® =====
async function saveToFirebase(coll, obj) {
  try {
    const docRef = await addDoc(coll, obj);
    obj.id = docRef.id;
    return obj;
  } catch (e) {
    alert(" æ–°å¢å¤±æ•—ï¼Œç¢ºèª Firebase æ¬Šé™");
    console.error("æ–°å¢å¤±æ•—", e);
    return null;
  }
}

window.addPlace = async function() {
  const t = prompt("æ–°å¢åœ°é»");
  if (t && t.trim() !== "") {
    const obj = await saveToFirebase(scheduleColl, { text: t, day: currentDay, category: currentCategory });
    if (obj) {
      data[currentDay][currentCategory].push(obj);
      renderScheduleItems();
    }
  }
};

window.addTodo = async function() {
  const t = prompt("å¾…è¾¦äº‹é …");
  if (t && t.trim() !== "") {
    const obj = await saveToFirebase(todoColl, { text: t, day: currentDay });
    if (obj) {
      data[currentDay].todo.push(obj);
      renderTodo();
    }
  }
};

window.addLuggage = async function() {
  const t = prompt("è¡Œæé …ç›®");
  if (t && t.trim() !== "") {
    const obj = await saveToFirebase(luggageColl, { text: t });
    if (obj) {
      luggage.push(obj);
      renderListWithDelete("luggageList", luggage, luggageColl);
    }
  }
};

window.addShopping = async function() {
  const t = prompt("è³¼ç‰©é …ç›®");
  if (t && t.trim() !== "") {
    const obj = await saveToFirebase(shoppingColl, { text: t });
    if (obj) {
      shopping.push(obj);
      renderListWithDelete("shoppingList", shopping, shoppingColl);
    }
  }
};

// ===== æ¸²æŸ“ =====
function renderTodo() {
  renderListWithDelete("todoList", data[currentDay].todo, todoColl);
}

// ===== åˆå§‹åŒ–ï¼Œè®€ Firebase =====
async function init() {
  renderDayButtons();
  renderSchedule();
  renderScheduleItems();
  renderTodo();
  renderListWithDelete("luggageList", luggage, luggageColl);
  renderListWithDelete("shoppingList", shopping, shoppingColl);

  // ===== å¾ Firebase è®€è³‡æ–™ =====
  const loadCollection = async (coll, targetArr, dayKey = null, categoryKey = null) => {
    const snapshot = await getDocs(coll);
    snapshot.forEach(docSnap => {
      const item = docSnap.data();
      item.id = docSnap.id;
      if (dayKey !== null && categoryKey !== null) {
        const dayIndex = Number(item[dayKey]);
        const cat = item[categoryKey];
        if (!isNaN(dayIndex) && targetArr[dayIndex] && targetArr[dayIndex][cat]) {
          targetArr[dayIndex][cat].push(item);
        }
      } else {
        targetArr.push(item);
      }
    });
  };

  await loadCollection(scheduleColl, data, "day", "category");
  await loadCollection(luggageColl, luggage);
  await loadCollection(shoppingColl, shopping);

const todoSnap = await getDocs(todoColl);
todoSnap.forEach(docSnap => {
  const item = docSnap.data();
  item.id = docSnap.id;

  const dayIndex = Number(item.day);
  if (!isNaN(dayIndex) && data[dayIndex]) {
    data[dayIndex].todo.push(item);
  }
});
  
  // é‡æ–°æ¸²æŸ“ç•«é¢
  renderScheduleItems();
  renderTodo();
  renderListWithDelete("luggageList", luggage, luggageColl);
  renderListWithDelete("shoppingList", shopping, shoppingColl);
}

init();

  

</script>


</body>
</html>
