<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>馬來西亞旅遊行程</title>
<style>
body{font-family:sans-serif;background:#f6f5f3;display:flex;flex-direction:column;align-items:center;padding:20px;}
.title-card{background:#f3e9d2;padding:12px 20px;border-radius:16px;text-align:center;font-size:26px;font-weight:600;margin-bottom:20px;color:#b3cccc;box-shadow:0 4px 6px rgba(0,0,0,0.1);}
.app{width:380px;background:#fff;border-radius:20px;padding:20px;}
.days{display:flex;overflow-x:auto;gap:6px;margin-bottom:12px;}
.day-btn{padding:6px 10px;border-radius:12px;border:none;background:#eee;cursor:pointer;}
.day-btn.active{background:#e5d5c3;}
.tabs{display:flex;gap:8px;margin:10px 0;}
.tab{flex:1;padding:8px;border-radius:20px;border:none;background:#eee;cursor:pointer;}
.tab.active{background:#e8dcca;}
.card{background:#faf9f7;padding:12px;border-radius:12px;margin-bottom:10px;display:flex;justify-content:space-between;align-items:center;}
.add-btn{width:100%;margin:12px 0;padding:10px;border-radius:12px;border:none;background:#d9cbb6;cursor:pointer;}
ul{padding-left:20px;} li{margin-bottom:6px;display:flex;justify-content:space-between;align-items:center;}
</style>
</head>
<body>
<div class="title-card">范家與李媽媽的馬來西亞旅遊行程</div>
<div class="app">
  <div class="days" id="dayButtons"></div>
  <h2 id="dayTitle"></h2>

  <!-- 景點、美食、住宿 tabs -->
  <div class="tabs">
    <button class="tab active" data-category="spot">景點</button>
    <button class="tab" data-category="food">美食</button>
    <button class="tab" data-category="stay">住宿</button>
  </div>
  <div id="schedule"></div>
  <button class="add-btn" onclick="addPlace()">＋ 新增地點</button>

  <hr>
  <h2>待辦事項</h2>
  <ul id="todoList"></ul>
  <button class="add-btn" onclick="addTodo()">＋ 新增待辦</button>

  <h2>行李清單</h2>
  <ul id="luggageList"></ul>
  <button class="add-btn" onclick="addLuggage()">＋ 新增行李</button>

  <h2>購物清單</h2>
  <ul id="shoppingList"></ul>
  <button class="add-btn" onclick="addShopping()">＋ 新增購物</button>
</div>

<script>
const days=[{date:"2/9",city:"台灣出發"},{date:"2/10",city:"馬六甲"},{date:"2/11",city:"波德申"},{date:"2/12",city:"吉隆坡"},{date:"2/13",city:"吉隆坡"},{date:"2/14",city:"梳邦"},{date:"2/15",city:"梳邦"},{date:"2/16",city:"回台灣"}];
let currentDay=0,currentCategory="spot",data=[],todo=[],luggage=[],shopping=[];

// 從後端抓資料
async function fetchAllData(){
  // 行程
  const scheduleRes = await fetch("http://localhost:3000/api/schedule");
  const scheduleData = await scheduleRes.json();
  data = days.map(()=>({spot:[],food:[],stay:[],todo:[]})); 
  scheduleData.forEach(item=>{
    if(data[item.day] && data[item.category]) data[item.day][item.category].push(item);
  });

  // 待辦
  const todoRes = await fetch("http://localhost:3000/api/todo");
  todo = await todoRes.json();

  // 行李
  const luggageRes = await fetch("http://localhost:3000/api/luggage");
  luggage = await luggageRes.json();

  // 購物
  const shoppingRes = await fetch("http://localhost:3000/api/shopping");
  shopping = await shoppingRes.json();
}

// 渲染按鈕
function renderDayButtons(){
  const c=document.getElementById("dayButtons"); c.innerHTML="";
  days.forEach((_,idx)=>{
    const b=document.createElement("button"); 
    b.className="day-btn"+(idx===currentDay?" active":"");
    b.textContent=`Day ${idx+1}`;
    b.onclick=()=>{currentDay=idx; updateActiveDay(); renderCurrentView();};
    c.appendChild(b);
  });
}
function updateActiveDay(){
  document.querySelectorAll(".day-btn").forEach((b,i)=>b.classList.toggle("active",i===currentDay));
}

// 渲染行程
function renderScheduleItems(){
  document.getElementById("dayTitle").textContent=`${days[currentDay].date} ${days[currentDay].city}`;
  const c=document.getElementById("schedule"); c.innerHTML="";
  data[currentDay][currentCategory].forEach((item,i)=>{
    const card=document.createElement("div"); card.className="card";
    const t=document.createElement("div"); t.textContent=item.text;
    const delBtn=document.createElement("button"); delBtn.textContent="X";
    delBtn.onclick=async()=>{
      await fetch(`http://localhost:3000/api/schedule/${item.id}`,{method:'DELETE'});
      data[currentDay][currentCategory].splice(i,1);
      renderScheduleItems();
    };
    card.append(t,delBtn); c.appendChild(card);
  });
}

// 渲染清單（待辦、行李、購物）
function renderList(id,arr,apiBase){
  const ul=document.getElementById(id); ul.innerHTML="";
  arr.forEach((item,i)=>{
    const li=document.createElement("li");
    li.textContent=item.text;
    const delBtn=document.createElement("button"); delBtn.textContent="X";
    delBtn.onclick=async()=>{
      await fetch(`${apiBase}/${item.id}`,{method:'DELETE'});
      arr.splice(i,1);
      renderList(id,arr,apiBase);
    };
    li.appendChild(delBtn);
    ul.appendChild(li);
  });
}

// 新增地點
async function addPlace(){
  const t=prompt("新增地點"); if(!t) return;
  const res = await fetch("http://localhost:3000/api/schedule",{
    method:'POST', headers:{'Content-Type':'application/json'},
    body:JSON.stringify({text:t, category:currentCategory, day:currentDay})
  });
  const obj = await res.json();
  data[currentDay][currentCategory].push(obj);
  renderScheduleItems();
}

// 新增待辦
async function addTodo(){
  const t=prompt("新增待辦"); if(!t) return;
  const res = await fetch("http://localhost:3000/api/todo",{
    method:'POST', headers:{'Content-Type':'application/json'},
    body:JSON.stringify({text:t, day:currentDay})
  });
  const obj = await res.json();
  data[currentDay].todo.push(obj);
  renderList("todoList",data[currentDay].todo,"http://localhost:3000/api/todo");
}

// 新增行李
async function addLuggage(){
  const t=prompt("新增行李"); if(!t) return;
  const res = await fetch("http://localhost:3000/api/luggage",{
    method:'POST', headers:{'Content-Type':'application/json'},
    body:JSON.stringify({text:t})
  });
  const obj = await res.json();
  luggage.push(obj);
  renderList("luggageList",luggage,"http://localhost:3000/api/luggage");
}

// 新增購物
async function addShopping(){
  const t=prompt("新增購物"); if(!t) return;
  const res = await fetch("http://localhost:3000/api/shopping",{
    method:'POST', headers:{'Content-Type':'application/json'},
    body:JSON.stringify({text:t})
  });
  const obj = await res.json();
  shopping.push(obj);
  renderList("shoppingList",shopping,"http://localhost:3000/api/shopping");
}

// tabs
document.querySelectorAll(".tab").forEach(tab=>{
  tab.onclick=()=>{
    document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
    tab.classList.add("active");
    currentCategory=tab.dataset.category;
    renderScheduleItems();
  }
});

// 初始化
async function init(){
  renderDayButtons();
  await fetchAllData();
  renderCurrentView();
}

function renderCurrentView(){
  renderScheduleItems();
  renderList("todoList",data[currentDay].todo,"http://localhost:3000/api/todo");
  renderList("luggageList",luggage,"http://localhost:3000/api/luggage");
  renderList("shoppingList",shopping,"http://localhost:3000/api/shopping");
}

init();
</script>
</body>
</html>
