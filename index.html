<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>é¦¬ä¾†è¥¿äºæ—…éŠè¡Œç¨‹</title>

  <style>
    /* æµ®æ°´å° */
    .watermark {
      position: fixed;           
      bottom: 20px;            
      right: 20px;             
      font-size: 16px;           
      font-weight: bold;         
      color: rgba(0, 0, 0, 0.3); 
      pointer-events: none;     
      user-select: none;         
      z-index: 9999;             
      text-shadow: 1px 1px 2px rgba(0,0,0,0.2); 
    }

    /* æ¨™é¡Œå¡ç‰‡ */
    .title-card {
      background: #f3e9d2;       /* æŸ”å’ŒèƒŒæ™¯è‰² */
      padding: 12px 20px;
      border-radius: 16px;       /* åœ“è§’ */
      text-align: center;
      font-size: 26px;
      font-weight: 600;
      margin-bottom: 20px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1); 
      color: #d9cbb6;           
    }

    body {
  background: #f6f5f3;
  font-family: sans-serif;
  display: flex;
  flex-direction: column; 
  align-items: center;    
  padding: 20px;
}
    .app {
      width: 380px;
      background: #fff;
      border-radius: 20px;
      padding: 20px;
    }
    .days {
      display: flex;
      overflow-x: auto;
      gap: 6px;
      margin-bottom: 12px;
    }
    .day-btn {
      padding: 6px 10px;
      border-radius: 12px;
      border: none;
      background: #eee;
      cursor: pointer;
    }
    .day-btn.active {
      background: #e5d5c3;
    }
    .tabs {
      display: flex;
      gap: 8px;
      margin: 10px 0;
    }
    .tab {
      flex: 1;
      padding: 8px;
      border-radius: 20px;
      border: none;
      background: #eee;
      cursor: pointer;
    }
    .tab.active {
      background: #e8dcca;
    }
    .card {
      background: #faf9f7;
      padding: 12px;
      border-radius: 12px;
      margin-bottom: 10px;
    }
    .add-btn {
      width: 100%;
      margin: 12px 0;
      padding: 10px;
      border-radius: 12px;
      border: none;
      background: #d9cbb6;
      cursor: pointer;
    }
  </style>
</head>

<body>
  
  <div class="title-card">é¦¬ä¾†è¥¿äºæ—…éŠè¡Œç¨‹</div>

  
  <div class="app">
    <div class="days" id="dayButtons"></div>
    <h2 id="dayTitle"></h2>

    <div class="tabs">
      <button class="tab active" data-category="spot">æ™¯é»</button>
      <button class="tab" data-category="food">ç¾é£Ÿ</button>
      <button class="tab" data-category="stay">ä½å®¿</button>
    </div>

    <div id="schedule"></div>
    <button class="add-btn" onclick="addPlace()">ï¼‹ æ–°å¢åœ°é»</button>

    <hr>

    <h2>å¾…è¾¦äº‹é …</h2>
    <ul id="todoList"></ul>
    <button class="add-btn" onclick="addTodo()">ï¼‹ æ–°å¢å¾…è¾¦</button>

    <h2>è¡Œææ¸…å–®</h2>
    <ul id="luggageList"></ul>
    <button class="add-btn" onclick="addLuggage()">ï¼‹ æ–°å¢è¡Œæ</button>

    <h2>è³¼ç‰©æ¸…å–®</h2>
    <ul id="shoppingList"></ul>
    <button class="add-btn" onclick="addShopping()">ï¼‹ æ–°å¢è³¼ç‰©</button>
  </div>

  
  <div class="watermark">made by Yuchi</div>
</body>
</html>


<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import {
  getFirestore,
  collection,
  addDoc,
  getDocs,
  deleteDoc,
  doc
} from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

/* ======================
   Firebase åˆå§‹åŒ–
====================== */
const firebaseConfig = {
  apiKey: "AIzaSyBOTh16RSCCca_FBUFiz0utDil-SlkZJKg",
  authDomain: "travel-plan-544b5.firebaseapp.com",
  projectId: "travel-plan-544b5",
  storageBucket: "travel-plan-544b5.firebasestorage.app",
  messagingSenderId: "794197854377",
  appId: "1:794197854377:web:5ac7eb18afb56618cf01b8"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* ======================
   åŸºæœ¬ç‹€æ…‹
====================== */
const days = [
  { date: "2/9", city: "å°ç£å‡ºç™¼" },
  { date: "2/10", city: "é¦¬å…­ç”²" },
  { date: "2/11", city: "æ³¢å¾·ç”³" },
  { date: "2/12", city: "æ³¢å¾·ç”³" },
  { date: "2/13", city: "å‰éš†å¡" },
  { date: "2/14", city: "å‰éš†å¡" },
  { date: "2/15", city: "æ¢³é‚¦" },
  { date: "2/16", city: "å›å°ç£" }
];

let currentDay = 0;
let currentCategory = "spot";

const data = days.map(() => ({
  spot: [],
  food: [],
  stay: [],
  todo: []
}));

const luggage = [];
const shopping = [];

/* ======================
   Firebase collections
====================== */
const scheduleColl = collection(db, "schedule");
const todoColl = collection(db, "todo");
const luggageColl = collection(db, "luggage");
const shoppingColl = collection(db, "shopping");

/* ======================
   è³‡æ–™è®€å–
====================== */
async function loadAllData() {
  // æ¸…ç©ºæœ¬åœ°ç‹€æ…‹
  data.forEach(d => {
    d.spot = [];
    d.food = [];
    d.stay = [];
    d.todo = [];
  });
  luggage.length = 0;
  shopping.length = 0;

  // è¡Œç¨‹
  const scheduleSnap = await getDocs(scheduleColl);
scheduleSnap.forEach(d => {
  const item = d.data();
  item.id = d.id;

  const day = Number(item.day);
  const cat = item.category;

  // ğŸš¨ é˜²å‘†æª¢æŸ¥
  if (
    Number.isNaN(day) ||
    !data[day] ||
    !data[day][cat]
  ) {
    console.warn("âš ï¸ ç•¥éå£è³‡æ–™", item);
    return;
  }

  data[day][cat].push(item);
});


  // å¾…è¾¦
  const todoSnap = await getDocs(todoColl);
  todoSnap.forEach(d => {
    const item = d.data();
    item.id = d.id;
    todo.push(item);
  });

  // è¡Œæ
  const luggageSnap = await getDocs(luggageColl);
  luggageSnap.forEach(d => {
    const item = d.data();
    item.id = d.id;
    luggage.push(item);
  });

  // è³¼ç‰©
  const shoppingSnap = await getDocs(shoppingColl);
  shoppingSnap.forEach(d => {
    const item = d.data();
    item.id = d.id;
    shopping.push(item);
  });
}

/* ======================
   Render functions
====================== */
function renderDayButtons() {
  const container = document.getElementById("dayButtons");
  container.innerHTML = "";

  days.forEach((_, idx) => {
    const btn = document.createElement("button");
    btn.className = "day-btn";
    if (idx === currentDay) btn.classList.add("active");
    btn.textContent = `Day ${idx + 1}`;
    btn.onclick = () => {
      currentDay = idx;
      updateActiveDay();
      renderCurrentView();
    };
    container.appendChild(btn);
  });
}

function updateActiveDay() {
  document.querySelectorAll(".day-btn").forEach((btn, idx) => {
    btn.classList.toggle("active", idx === currentDay);
  });
}

function renderSchedule() {
  document.getElementById("dayTitle").textContent =
    `${days[currentDay].date} ${days[currentDay].city}`;
}

function renderScheduleItems() {
  const container = document.getElementById("schedule");
  container.innerHTML = "";

  const items = data[currentDay][currentCategory];
  items.forEach((item, index) => {
    const card = document.createElement("div");
    card.className = "card";

    const text = document.createElement("div");
    text.textContent = item.text;

    const mapBtn = document.createElement("button");
    mapBtn.textContent = "ğŸ“ æŸ¥çœ‹åœ°åœ–";
    mapBtn.onclick = () => {
      window.open(
        `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(item.text)}`,
        "_blank"
      );
    };

    const delBtn = document.createElement("button");
    delBtn.textContent = "X";
    delBtn.onclick = async () => {
      await deleteDoc(doc(db, scheduleColl.path, item.id));
      items.splice(index, 1);
      renderScheduleItems();
    };

    card.append(text, mapBtn, delBtn);
    container.appendChild(card);
  });
}

function renderList(id, arr, coll) {
  const ul = document.getElementById(id);
  ul.innerHTML = "";

  arr.forEach((item, index) => {
    const li = document.createElement("li");
    li.textContent = item.text;

    const delBtn = document.createElement("button");
    delBtn.textContent = "X";
    delBtn.onclick = async () => {
      await deleteDoc(doc(db, coll.path, item.id));
      arr.splice(index, 1);
      renderList(id, arr, coll);
    };

    li.appendChild(delBtn);
    ul.appendChild(li);
  });
}

function renderCurrentView() {
  renderSchedule();
  renderScheduleItems();
  renderList("todoList", data[currentDay].todo, todoColl);
  renderList("luggageList", luggage, luggageColl);
  renderList("shoppingList", shopping, shoppingColl);
}

/* ======================
   æ–°å¢è³‡æ–™
====================== */
async function save(coll, obj) {
  const ref = await addDoc(coll, obj);
  obj.id = ref.id;
  return obj;
}

window.addPlace = async () => {
  const text = prompt("æ–°å¢åœ°é»");
  if (!text) return;

  const obj = await save(scheduleColl, {
    text,
    day: currentDay,
    category: currentCategory
  });

  data[currentDay][currentCategory].push(obj);
  renderScheduleItems();
};

window.addTodo = async () => {
  const text = prompt("æ–°å¢å¾…è¾¦");
  if (!text) return;

  const obj = await save(todoColl, { text });
  data[currentDay].todo.push(obj);
  renderCurrentView();
};

window.addLuggage = async () => {
  const text = prompt("æ–°å¢è¡Œæ");
  if (!text) return;

  const obj = await save(luggageColl, { text });
  luggage.push(obj);
  renderCurrentView();
};

window.addShopping = async () => {
  const text = prompt("æ–°å¢è³¼ç‰©");
  if (!text) return;

  const obj = await save(shoppingColl, { text });
  shopping.push(obj);
  renderCurrentView();
};

/* ======================
   Tabs
====================== */
document.querySelectorAll(".tab").forEach(tab => {
  tab.onclick = () => {
    document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
    tab.classList.add("active");
    currentCategory = tab.dataset.category;
    renderScheduleItems();
  };
});

/* ======================
   Init
====================== */
async function init() {
  renderDayButtons();
  await loadAllData();
  renderCurrentView();
}

init();
</script>

</body>
</html>
